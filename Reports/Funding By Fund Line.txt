DECLARE @AcademicYear NVARCHAR(5) = '25/26'
DECLARE @ILRReturn NVARCHAR(3) = 'R03'
DECLARE @IsFinalReturn BIT = 1


SELECT
	FD.FundLineCategoryOrder,
	FD.FundLineCategory,
	FD.FundLineSubCategoryOrder,
	FundLineSubCategory,
	FD.FundLine,
	Learners = COUNT ( DISTINCT FD.LearnRefNumber ),
	Enrolments = COUNT ( FD.LearnRefNumber ),
	TotalEarnedCash = SUM ( FD.TotalEarnedCashYearEnd )
FROM FIS_FundingData FD
WHERE
	FD.AcademicYear = @AcademicYear
	AND FD.ILRReturn = @ILRReturn
	AND FD.IsFinalReturn = @IsFinalReturn
	--AND FD.IsFundedStart = 1
GROUP BY
	FD.FundLineCategoryOrder,
	FD.FundLineCategory,
	FD.FundLineSubCategoryOrder,
	FD.FundLineSubCategory,
	FD.FundLine
ORDER BY
	FD.FundLineCategoryOrder,
	FD.FundLineSubCategoryOrder,
	FD.FundLineSubCategory,
	FD.FundLine