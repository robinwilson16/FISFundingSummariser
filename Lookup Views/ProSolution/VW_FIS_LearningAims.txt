CREATE VIEW VW_FIS_LearningAims
AS
	SELECT
		SSA1Code = AIM.SSA1ID,
		SSA1Name = SSA1.SSA_Tier1_Desc,
		SSA2Code = AIM.SSA2ID,
		SSA2Name = SSA2.SSA_Tier2_Desc,
		LearningAimCode = AIM.LEARNING_AIM_REF,
		LearningAimTitle = AIM.LEARNING_AIM_TITLE,
		LearningAimTypeCode = AIM.LEARNING_AIM_TYPE_CODE,
		LearningAimTypeName = AIMT.LEARNING_AIM_TYPE_DESC,
		NVQLevelCode = COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ),
		NVQLevelName = 
			CASE
				WHEN COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ) = 'E' THEN 'Entry Level'
				ELSE 'Level ' + COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' )
			END,
		NVQLevelOrder = 
			CASE
				WHEN COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ) = 'E' THEN 0
				WHEN COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ) = 'X' THEN 0.5
				WHEN COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ) = 'H' THEN 4
				WHEN COALESCE ( AIM.NOTIONAL_NVQ_LEVEL_CODE, 'X' ) = 'M' THEN 3
				ELSE TRY_CAST ( AIM.NOTIONAL_NVQ_LEVEL_CODE AS INT )
			END,
		IsMathsAndEnglish = 
			CASE
				WHEN 
					AIM.LEARNING_AIM_TYPE_CODE IN (
						'0003', --GCSE
						'1439' --FS
					)
					AND (
						AIM.LEARNING_AIM_TITLE LIKE '%Math%'
						OR AIM.LEARNING_AIM_TITLE LIKE '%English%'
					)
					THEN 'Y'
				ELSE 'N'
			END,
		AwardBodyCode = AIM.AWARDING_BODY_CODE
	FROM ProSolution.dbo.Learning_Aim AIM
	INNER JOIN ProSolution.dbo.LEARNING_AIM_TYPES AIMT
		ON AIMT.LEARNING_AIM_TYPE_CODE = AIM.LEARNING_AIM_TYPE_CODE
	LEFT JOIN ProSolution.dbo.SSA1 SSA1
		ON SSA1.SSA_Tier1_code = AIM.SSA1ID
	LEFT JOIN ProSolution.dbo.SSA2 SSA2
		ON SSA2.SSA_Tier2_code = AIM.SSA2ID