CREATE VIEW FIS_LearningAims
AS
	SELECT
		SSA1Code = AIM.SectorSubjectAreaTier1,
		SSA1Name = SSA1.SectorSubjectAreaTier1Desc,
		SSA2Code = AIM.SectorSubjectAreaTier2,
		SSA2Name = SSA2.SectorSubjectAreaTier2Desc,
		LearningAimCode = AIM.LearnAimRef,
		LearningAimTitle = AIM.LearnAimRefTitle,
		LearningAimTypeCode = AIM.LearnAimRefType,
		LearningAimTypeName = AIMT.LearnAimRefTypeDesc,
		NVQLevelCode = AIM.NotionalNVQLevelv2,
		NVQLevelName = 
			CASE
				WHEN COALESCE ( AIM.NotionalNVQLevelv2, 'X' ) = 'E' THEN 'Entry Level'
				ELSE 'Level ' + COALESCE ( AIM.NotionalNVQLevelv2, 'X' )
			END,
		NVQLevelOrder = 
			CASE
				WHEN COALESCE ( AIM.NotionalNVQLevelv2, 'X' ) = 'E' THEN 0
				WHEN COALESCE ( AIM.NotionalNVQLevelv2, 'X' ) = 'X' THEN 0.5
				WHEN COALESCE ( AIM.NotionalNVQLevelv2, 'X' ) = 'H' THEN 4
				WHEN COALESCE ( AIM.NotionalNVQLevelv2, 'X' ) = 'M' THEN 3
				ELSE TRY_CAST ( AIM.NotionalNVQLevelv2 AS INT )
			END,
		IsMathsAndEnglish = 
			CASE
				WHEN 
					AIM.LearnAimRefType IN (
						'0003', --GCSE
						'1439' --FS
					)
					AND (
						AIM.LearnAimRefTitle LIKE '%Math%'
						OR AIM.LearnAimRefTitle LIKE '%English%'
					)
					THEN 'Y'
				ELSE 'N'
			END,
		AwardBodyCode = AIM.AwardOrgCode,
		AwardBodyName = AB.AwardOrgName
	FROM LARS.dbo.Core_LARS_LearningDelivery AIM
	INNER JOIN LARS.dbo.CoreReference_LARS_SectorSubjectAreaTier1_Lookup SSA1
		ON SSA1.SectorSubjectAreaTier1 = AIM.SectorSubjectAreaTier1
	INNER JOIN LARS.dbo.CoreReference_LARS_SectorSubjectAreaTier2_Lookup SSA2
		ON SSA2.SectorSubjectAreaTier2 = AIM.SectorSubjectAreaTier2
	INNER JOIN LARS.dbo.CoreReference_LARS_LearnAimRefType_Lookup AIMT
		ON AIMT.LearnAimRefType = AIM.LearnAimRefType
	INNER JOIN LARS.dbo.CoreReference_LARS_AwardOrgCode_Lookup AB
		ON AB.AwardOrgCode = AIM.AwardOrgCode