DECLARE @ProviderNumber INT = 10007928
DECLARE @AcademicYear NVARCHAR(5) = '23/24'


SELECT
	FD.LearningAimCode,
	FD.LearningAimTitle,
	FD.FundLineType,
	Enrols = COUNT ( FD.LearnRefNumber ),
	Funded = SUM ( FD.IsFundedStart ),
	Starts = SUM ( FD.IsOverallStart ),
	Leavers = SUM ( FD.IsOverallLeaver ),
	Continuers = SUM ( FD.IsOverallContinuerFunded ),
	Completers = SUM ( FD.IsOverallCompletedFunded ),
	Retained = SUM ( FD.IsOverallRetainedFunded ),
	WithdrawnAll = SUM ( FD.IsOverallWithdrawnFunded ),
	WithdrawnPre = SUM ( FD.IsOverallWithdrawnPreEligibility ),
	WithdrawnPost = SUM ( FD.IsOverallWithdrawnPostEligibility ),
	Achieved = SUM ( FD.IsOverallAchieverFunded )
FROM FIS_FundingData FD
WHERE
	FD.ProviderNumber = @ProviderNumber
	AND FD.HybridEndYear = @AcademicYear
	AND FD.IncludeInQARMeasures = 1
	--AND FD.LearningAimCode = '40009488'
	AND FD.FundLineType = 'ESFA'
	--AND FD.IsOverallLeaver = 1
	--AND FD.IsOverallCompletedFunded = 1
	--AND FD.IsOverallAchieverFunded = 1
	--AND FD.IsOverallContinuerFunded = 1
GROUP BY
	FD.LearningAimCode,
	FD.LearningAimTitle,
	FD.FundLineType
ORDER BY
	FD.LearningAimCode,
	FD.FundLineType